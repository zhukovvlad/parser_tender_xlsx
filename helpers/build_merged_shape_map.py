def build_merged_shape_map(ws):
    """
    Создает и возвращает карту размеров объединенных ячеек на листе Excel.

    Эта функция проходит по всем диапазонам объединенных ячеек на предоставленном
    листе `openpyxl.worksheet.worksheet.Worksheet`. Для каждого такого диапазона
    она вычисляет количество объединенных строк (rowspan) и столбцов (colspan).
    Затем для каждой отдельной ячейки, входящей в этот объединенный диапазон,
    в итоговый словарь добавляется запись, где ключом является координата ячейки
    (например, "A1", "B2"), а значением — словарь с информацией о rowspan и colspan
    всего объединенного диапазона, к которому эта ячейка принадлежит.

    Это полезно для определения фактических размеров объединенной ячейки,
    когда известна координата любой из входящих в нее ячеек.

    Args:
        ws (openpyxl.worksheet.worksheet.Worksheet): Активный лист Excel,
            из которого будут считываться данные об объединенных ячейках.

    Returns:
        dict: Словарь, где:
            - ключ (str): Координата ячейки (например, "A1"), которая является частью
                          объединенного диапазона.
            - значение (dict): Словарь с двумя ключами:
                - "rowspan" (int): Количество строк, которые занимает объединенная
                                   ячейка.
                - "colspan" (int): Количество столбцов, которые занимает объединенная
                                   ячейка.
    
    Пример возвращаемого значения для ячейки "A1", которая является частью
    диапазона, объединенного на 2 строки и 3 столбца:
    {
        "A1": {"rowspan": 2, "colspan": 3},
        "B1": {"rowspan": 2, "colspan": 3},
        "C1": {"rowspan": 2, "colspan": 3},
        "A2": {"rowspan": 2, "colspan": 3},
        "B2": {"rowspan": 2, "colspan": 3},
        "C2": {"rowspan": 2, "colspan": 3}
        // ... и так далее для других объединенных диапазонов на листе
    }
    """
    merged_map = {}
    # ws.merged_cells.ranges возвращает список объектов MergedCellRange
    for merged_range in ws.merged_cells.ranges:
        # Вычисляем rowspan и colspan для текущего объединенного диапазона
        rowspan = merged_range.max_row - merged_range.min_row + 1
        colspan = merged_range.max_col - merged_range.min_col + 1
        
        # Проходим по всем ячейкам внутри этого объединенного диапазона
        # ws[merged_range.coord] возвращает кортеж кортежей ячеек (Cell)
        for row_of_cells in ws[merged_range.coord]:
            for cell in row_of_cells:
                # Каждой ячейке в объединенном диапазоне сопоставляем
                # размеры всего этого диапазона
                merged_map[cell.coordinate] = {"rowspan": rowspan, "colspan": colspan}
    return merged_map