"""
Модуль для поиска строк в Excel по содержимому первой колонки.

Предоставляет утилиту для нахождения номера строки на листе Excel,
первая ячейка которой (в колонке 'A') содержит определенный текстовый фрагмент.
Функция позволяет задавать диапазон поиска и полезна для обнаружения
строк-заголовков или ключевых данных в таблицах.
"""

from typing import Optional
from openpyxl.worksheet.worksheet import Worksheet


def find_row_by_first_column(
    ws: Worksheet,
    target_text: str,
    start_row: int = 1,
    end_row: Optional[int] = None
) -> Optional[int]:
    """
    Ищет первую строку на листе Excel, в которой значение первой ячейки (колонка A)
    содержит указанный текст.

    Поиск производится в заданном диапазоне строк (по умолчанию от первой до последней
    заполненной строки на листе). Если значение ячейки в первой колонке является
    строкой и искомый текст `target_text` присутствует в этой строке
    (как подстрока, с учетом регистра), функция возвращает номер этой строки.

    Args:
        ws (Worksheet): Лист Excel (объект openpyxl.worksheet.worksheet.Worksheet),
            на котором производится поиск.
        target_text (str): Текст, который необходимо найти в первой колонке.
        start_row (int, optional): Номер строки, с которой начинается поиск
            (1-индексация). По умолчанию равен 1.
        end_row (Optional[int], optional): Номер строки, на которой заканчивается
            поиск (включительно). По умолчанию равен максимальному количеству строк
            на листе (`ws.max_row`).

    Returns:
        Optional[int]: Номер первой строки (1-индексация), удовлетворяющей условиям
            поиска. Возвращает `None`, если такая строка не найдена в указанном
            диапазоне.
    
    Пример:
        Если в ячейке A5 листа `ws` находится текст "Пример текста для поиска",
        то вызов `find_row_by_first_column(ws, "текста для")` вернет `5`.
    """
    # Если конечная строка для поиска не задана, используем максимальную строку листа.
    if end_row is None:
        end_row = ws.max_row

    # Итерируемся по строкам в указанном диапазоне (включительно end_row).
    for row_index in range(start_row, end_row + 1):
        # Получаем значение ячейки в первой колонке (колонка 1) текущей строки.
        cell = ws.cell(row=row_index, column=1)
        cell_value = cell.value

        # Проверяем, является ли значение ячейки строкой
        # и содержит ли оно искомый текст (target_text).
        if isinstance(cell_value, str) and target_text in cell_value:
            return row_index  # Возвращаем номер строки, если условие выполнено
            
    # Если ни одна строка не подошла под условия в заданном диапазоне.
    return None