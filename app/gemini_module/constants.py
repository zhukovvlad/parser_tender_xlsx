# app/gemini_module/constants.py

# Метка по умолчанию для документов, которые не подошли ни под одну категорию.
FALLBACK_CATEGORY = "Прочее"

# ======================================================================
# === ЕДИНЫЙ ИСТОЧНИК ПРАВДЫ ДЛЯ ВСЕХ КОНФИГУРАЦИЙ ===
# ======================================================================
# Чтобы добавить новую категорию, просто добавьте новый ключ и его
# значение в этот словарь. Список TENDER_CATEGORIES обновится автоматически.
TENDER_CONFIGS = {
    "Нулевой цикл": {
        "prompt_hint": (
            "Это тендер на нулевой цикл. Обрати внимание на земляные работы, "
            "устройство ограждающих конструкций котлована, свайные работы, "
            "а также устройство шпунтового ограждения котлована."
        ),
        "json_structure": """
        {
          "pit_specs": {
            "is_included": "Есть ли земляные работы по устройству котлована (true/false)" <bool>,
            "pit_volume_m3": [
              "Список земляных работ ТОЛЬКО для устройства котлована "
              "(не надо учитывать другие работы, например, для устройства "
              "форшахты и тому подобное) в кубометрах (только числа)"
            ] [<список чисел> | null]
          },
          "slurry_wall_specs": {
            "is_included": "Есть ли устройство стены в грунте в документе (true/false)" <bool>,
            "thickness_mm": "толщина стены в грунте. Либо указана явно, либо можно определить по косвенным признакам, например, по ширине траншеи форшазты" <число | null>,
            "concrete_volume_m3": ["количество бетона используемого для устройства основной стены в грунте без форшахты и обвязочной балки"] [<список чисел> | null],
            "concrete_grade": "марка и тип используемого бетона для устройства основной стены в грунте" <строка | null>,
            "rebar_type": "тип арматуры используемой для устройства основной стены в грунте" <строка | null>,
            "rebar_total_weight_t": ["общий вес арматуры используемой для устройства основной стены в грунте"] [<список чисел> | null]
          },
          "sheet_pile_wall_specs": {
            "is_included": "Есть ли шпунтовое ограждение котлована (true/false)" <bool>,
            "length_m": ["Протяжённость шпунтового ограждения в погонных метрах (м.п.)"] [<список чисел> | null],
            "diameter_mm": "Диаметр шпунта в миллиметрах, если указан (например, 530 из "Труба ограждения 530x8 мм")" <число | null>,
            "type": "Тип шпунта (например, Larsen IV, трубошпунт, шпунтовые сваи и т.п.), если указан" <строка | null>
          },
          "strut_system_specs": {
            "is_included": "Есть ли распорная система для крепления котлована (true/false)" <bool>,
            "strut_system_weights_t": ["вес распорной системы в тоннах"] [<список чисел float> | null]
          },
          "main_pile_specs": "Определяем наличие и данные для основного свайного поля, если оно есть." {
            "is_included": "Есть ли основное свайное поле (true/false)" <bool>,
            "diameter_mm": "Диаметр свай в миллиметрах (например, 800 из "бурение скважин диаметром 800 мм")" <число или null>,
            "count": "Количество свай в штуках (шт) если удастся найти эти данные" <целое число или null>,
            "concrete_volume_m3": ["Объем бетона для свай в кубических метрах (м³). Учитывать только бетон, необходимый для заливки самого тела сваи"] [<список чисел> или null],
            "concrete_grade": "Марка или класс бетона в основных сваях (например, "B25", "B25 W8 F150")" <строка или null>,
            "rebar_total_weight_t": "Общий вес арматуры или армокаркасов в тоннах (т)" [<список чисел> или null],
            "rebar_type": "Класс используемой арматуры (например, "A500C")" <строка или null>,
            "grouting_volume_m3": "Объем цементации под пятой сваи в кубических метрах (м³) если есть" [<список чисел> или null]
          },
          "testing_pile_specs": "Определяем наличие и данные для испытуемых свай (устройство испытуемых свай является отдельной работой и служит для проверки их несущей способности и определения характеристик будущего основного свайного поля, в дальнейшем данные сваи становятся частью основного свайного поля), если они есть. На испытуемую сваю сверху устанавливается специальный домкрат, который позволяет измерять нагрузки и деформации. Для большей устойчивости домкрата используются дополнительные анкерные сваи" {
            "is_included": "Есть ли испытуемые сваи (true/false) согласно нашему описанию? Если нет, то заполненять поля данного раздела дальше не нужно" <bool>,
            "testing_piles": "Список характеристик испытуемых свай, если есть" {
              "diameter_mm": "Диаметр испытуемых свай в миллиметрах (например, 800 из "бурение скважин диаметром 800 мм")" <число или null>,
              "count_test_piles": "Количество испытуемых свай в штуках (шт) если удастся найти эти данные" <целое число или null>,
              "concrete_volume_m3": ["Объем бетона для испытуемых свай в кубических метрах (м³)"] [<список чисел> или null],
              "concrete_grade": "Марка или класс бетона в испытуемых сваях (например, "B25", "B25 W8 F150")" <строка или null>,
              "rebar_total_weight_t": "Общий вес арматуры или армокаркасов в тоннах (т)" [<список чисел> или null],
              "rebar_type": "Класс используемой арматуры (например, "A500C")" <строка или null>
            },
            "anker_pile_specs": "Определяем наличие и данные для анкерных свай, если они есть." {
              "diameter_mm": "Диаметр анкерных свай в миллиметрах (например, 800 из "бурение скважин диаметром 800 мм")" <число или null>,
              "count_test_piles": "Количество анкерных свай в штуках (шт) если удастся найти эти данные" <целое число или null>,
              "concrete_volume_m3": ["Объем бетона для анкерных свай в кубических метрах (м³)"] [<список чисел> или null],
              "concrete_grade": "Марка или класс бетона в анкерных сваях (например, "B25", "B25 W8 F150")" <строка или null>,
              "rebar_total_weight_t": "Общий вес арматуры или армокаркасов в тоннах (т)" [<список чисел> или null],
              "rebar_type": "Класс используемой арматуры (например, "A500C")" <строка или null>
            }
          }
        """,
    },
    "Проектирование и BIM": {
        "prompt_hint": (
            "Это тендер на проектные работы. Обрати особое внимание на стадии "
            "проектирования (П, РД), требования к программному обеспечению (BIM) и состав команды."
        ),
        "json_structure": """
        {
          "project_name": "Название проекта или объекта",
          "services_list": ["Список ключевых услуг по проектированию"],
          "bim_standard": "Требуемый стандарт или версия BIM (если указано)",
          "deadline_days": "Срок выполнения в календарных днях (только число)"
        }
        """,
    },
    "Строительный контроль": {
        "prompt_hint": (
            "Это тендер на услуги строительного контроля (технадзора). "
            "Ищи информацию о функциях контролера, объекте контроля и частоте предоставления отчетов."
        ),
        "json_structure": """
        {
          "controlled_object": "Наименование объекта контроля",
          "control_functions": ["Список функций строительного контроля"],
          "reporting_frequency": "Периодичность предоставления отчетов",
          "duration_months": "Продолжительность оказания услуг в месяцах (только число)"
        }
        """,
    },
    "Отделка": {
        "prompt_hint": (
            "Это тендер на внутренние отделочные работы. Ищи информацию о **видах отделки** "
            "(черновая/чистовая) и **площадях**. \n"
            "**Приоритет для 'total_area_m2':** площадь потолка (м²). Если она не указана, используй площадь пола. \n"
            "**Ключевая задача:** Разделить работы и площади на **Квартиры** (Apartments), "
            "**Лобби/Гранд-лобби** (Lobby - вестибюли, зоны ресепшн) и "
            "**МОП** (MOП - места общего пользования, коридоры, лестничные клетки, колясочные, ПУИ). \n"
            "При подсчете площадей стен, полов и потолков **избегай задвоения** (не суммируй слои) и **исключай 'тех. пространства'**."
        ),
        "json_structure": """
        {
          "finishing_type": "Общий тип отделки в документе (например, комплексная внутренняя чистовая и черновая)" <строка | null>,
          "total_area_m2": [
            "Общая площадь горизонтальной поверхности (ПОТОЛКА или ПОЛА) в м² по всем зонам. "
            "**Приоритет: площадь потолка (м²).** Если площадь потолка не указана, используй площадь пола. "
            "**Исключать 'тех пространство' и 'вертикальные плоскости' из этого расчета.**"
          ] [<список чисел> | null],

          "apartment_finishing": "Раздел для отделки квартир (жилые помещения)" {
            "is_included": "Есть ли работы по отделке квартир (true/false)" <bool>,
            "ceiling_area_m2": [
              "Общая площадь потолков (горизонтальная часть) в м² для всех квартир. "
              "**Исключать любые работы, в описании которых явно указано 'вертикальная плоскость'.**"
            ] [<список чисел> | null],
            "floor_area_m2": [
              "Общая площадь полов (горизонтальная поверхность) в м² для всех квартир. "
              "**Необходимо явно исключать любые работы, относящиеся к 'тех пространство' (техническое пространство).**"
            ] [<список чисел> | null],
            "wall_area_m2": [
              "Общая площадь стен (вертикальная поверхность) в м² для всех квартир. "
              "**Учитывать только площадь самого основания (по стене) без наслоения слоев (штукатурка, шпатлевка и т.д.) и исключая площадь проемов (дверей, люков).**"
            ] [<список чисел> | null],

            "rough_finishing": "Черновая отделка квартир" {
                "is_included": "Есть ли черновая отделка квартир (true/false)" <bool>,
                "area_m2": ["Площадь черновой отделки квартир в м² (горизонтальная поверхность, например, стяжка)"] [<список чисел> | null],
                "key_materials": ["Список основных материалов для черновой отделки (штукатурка, стяжка пола и т.п.)"] [<список строк> | null]
            },

            "fine_finishing": "Чистовая отделка квартир" {
                "is_included": "Есть ли чистовая отделка квартир (true/false)" <bool>,
                "area_m2": ["Площадь чистовой отделки квартир в м² (горизонтальная поверхность, например, ламинат)"] [<список чисел> | null],
                "key_materials": ["Список основных материалов для чистовой отделки (обои, ламинат, межкомнатные двери и т.п.)"] [<список строк> | null]
            }
          },

          "public_areas_finishing": "Раздел для отделки общественных зон (Лобби и МОП)" {
            "is_included": "Есть ли работы по отделке общественных зон (true/false)" <bool>,

            "lobby": "Работы по Лобби и Гранд-лобби (вестибюли, зоны ресепшн, зоны ожидания)" {
              "is_included": "Есть ли работы, явно относящиеся к Лобби/Гранд-лобби (true/false)" <bool>,
              "ceiling_area_m2": [
                "Площадь потолков (горизонтальная часть) в м² **только для Лобби/Гранд-лобби**. "
                "**Исключать 'вертикальные плоскости'.**"
              ] [<список чисел> | null],
              "floor_area_m2": [
                "Площадь полов (горизонтальная) в м² **только для Лобби/Гранд-лобби**. "
                "**Исключать 'тех пространство'.**"
              ] [<список чисел> | null],
              "wall_area_m2": [
                "Площадь стен (вертикальная) в м² **только для Лобби/Гранд-лобби**. "
                "**Считать по основанию, без наслоения слоев и без проемов.**"
              ] [<список чисел> | null],
              "key_materials": ["Список основных материалов для Лобби (мрамор, декоративные панели, керамогранит и т.п.)"] [<список строк> | null]
            },

            "mop": "Работы по МОП (Места Общего Пользования: коридоры на этажах, лестничные клетки, колясочные, ПУИ)" {
              "is_included": "Есть ли работы, явно относящиеся к МОП (true/false)" <bool>,
              "ceiling_area_m2": [
                "Площадь потолков (горизонтальная часть) в м² **только для МОП**. "
                "**Исключать 'вертикальные плоскости'.**"
              ] [<список чисел> | null],
              "floor_area_m2": [
                "Площадь полов (горизонтальная) в м² **только для МОП**. "
                "**Исключать 'тех пространство'.**"
              ] [<список чисел> | null],
              "wall_area_m2": [
                "Площадь стен (вертикальная) в м² **только для МОП**. "
                "**Считать по основанию, без наслоения слоев и без проемов.**"
              ] [<список чисел> | null],
              "key_materials": ["Список основных материалов для МОП (краска, плитка ГКЛ и т.п.)"] [<список строк> | null]
            }
          }
        }
        """,
    },
    # Конфигурация для "Прочее" должна быть здесь, но она не попадет
    # в список для классификации.
    FALLBACK_CATEGORY: {
        "prompt_hint": (
            "Это документ общего типа. Постарайся определить его основную суть, "
            "заголовок и найти контактную информацию."
        ),
        "json_structure": """
        {
          "document_title": "Полный заголовок или название документа",
          "main_subject": "Основной предмет или тема документа в 1-2 предложениях",
          "contacts": "Контактные лица или реквизиты для связи"
        }
        """,
    },
}


# ======================================================================
# === АВТОМАТИЧЕСКИ ГЕНЕРИРУЕМЫЕ КОНСТАНТЫ ===
# ======================================================================

# Список категорий для классификации теперь генерируется из ключей словаря TENDER_CONFIGS.
# Мы исключаем из него нашу "запасную" категорию.
TENDER_CATEGORIES = [category for category in TENDER_CONFIGS.keys() if category != FALLBACK_CATEGORY]
